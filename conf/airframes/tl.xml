<airframe name="TwistedLogic">

  <servos min="0" neutral="0" max="0xff">
    <servo name="AILERON"  no="2" min="900" neutral="1500" max="2100"/>
    <servo name="ELEVATOR" no="1" min="900" neutral="1500" max="2100"/>
    <servo name="MOTOR_RIGHT"   no="6" min="1250" neutral="1250" max="1810"/>   
 
    <servo name="MOTOR_LEFT"   no="3" min="1250" neutral="1250" max="1810"/>
    <servo name="CAM" no="0" min="900" neutral="1500" max="2100"/>
   </servos>

  <commands>
    <axis name="THROTTLE" failsafe_value="0"/>
    <axis name="ROLL"     failsafe_value="0"/>
    <axis name="PITCH"    failsafe_value="0"/>
    <axis name="YAW"    failsafe_value="0"/>
    <axis name="CAM"    failsafe_value="0"/>
   </commands>

  <command_laws>
          <let var="roll"     value="1.0  * @ROLL"/>
          <let var="pitch"    value="1.0  * @PITCH"/>
          <let var="yaw"      value="0.1 * @YAW"/>
          <let var="throttle" value="1.0   * @THROTTLE"/>
          <let var="right" value="$throttle + $yaw"/><!-- add trim term for Right -->
          <let var="left" value="$throttle - $yaw"/><!-- .06*thrsubtract trim term for Right -->  
          <set servo="AILERON" value="$roll"/>
          <set servo="ELEVATOR"  value="$pitch"/>
          <set servo="MOTOR_LEFT"  value="$left - Max(0, $right - MAX_PPRZ)"/> 
          <set servo="MOTOR_RIGHT" value="$right - Max(0, $left - MAX_PPRZ)"/>
          <set servo="CAM" value="@CAM"/>
   </command_laws>

  <rc_commands>
    <set command="THROTTLE" value="@THROTTLE"/>
    <set command="ROLL" value="@ROLL"/>
    <set command="PITCH" value="@PITCH"/>
    <set command="YAW" value="@YAW"/>
    <set command="CAM"    value="@GAIN1"/>
   </rc_commands>


  <makefile>
ARCHI=arm7

FLASH_MODE = IAP

ap.ARCHDIR = $(ARCHI)
ap.ARCH = arm7tdmi
ap.TARGET = flt
ap.TARGETDIR = flt

ap.CFLAGS += -DCONFIG=\"tiny_1_1.h\"  -DPERIODIC_TASK_PERIOD='SYS_TICS_OF_SEC(15e-3)' 
ap.srcs = tl_main.c sys_time.c $(SRC_ARCH)/sys_time_hw.c $(SRC_ARCH)/armVIC.c

ap.CFLAGS += -DLED  -DLED -DTIME_LED=1

ap.srcs += commands.c

ap.CFLAGS += -DACTUATORS=\"servos_4015_MAT_hw.h\" -DSERVOS_4015_MAT
ap.srcs += $(SRC_ARCH)/servos_4015_MAT_hw.c actuators.c

ap.CFLAGS += -DRADIO_CONTROL -DRADIO_CONTROL_TYPE=RC_FUTABA
ap.srcs += radio_control.c $(SRC_ARCH)/ppm_hw.c  

# transparent 
ap.CFLAGS += -DDOWNLINK -DUSE_UART0 -DDOWNLINK_TRANSPORT=PprzTransport -DDOWNLINK_AP_DEVICE=Uart0 -DPPRZ_UART=Uart0 -DDATALINK=PPRZ -DUART0_BAUD=B9600
ap.srcs += downlink.c $(SRC_ARCH)/uart_hw.c pprz_transport.c tl_telemetry.c tl_datalink.c

ap.srcs += tl_autopilot.c tl_control.c tl_estimator.c

ap.CFLAGS += -DGPS -DUBX -DUSE_UART1 -DGPS_LINK=Uart1 -DUART1_BAUD=B38400 -DDOWNLINK_GPS_DEVICE=DOWNLINK_AP_DEVICE
ap.srcs += gps_ubx.c gps.c latlong.c



  </makefile>

</airframe>
