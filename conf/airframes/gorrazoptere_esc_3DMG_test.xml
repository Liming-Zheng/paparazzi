<airframe name="Gorrazoptere_esc_3dmg">
  <servos>
    <servo name="MOTOR_FRONT" no="0" min="0" neutral="0" max="0x3ff"/>
    <servo name="MOTOR_BACK"  no="1" min="0" neutral="0" max="0x3ff"/>
    <servo name="MOTOR_LEFT"  no="2" min="0" neutral="0" max="0x3ff"/>
    <servo name="MOTOR_RIGHT" no="3" min="0" neutral="0" max="0x3ff"/>
  </servos>

  <commands>
    <axis name="THROTTLE"  failsafe_value="0"/>
    <axis name="ROLL_DOT"  failsafe_value="0"/>
    <axis name="PITCH_DOT" failsafe_value="0"/>
    <axis name="YAW_DOT"   failsafe_value="0"/>
  </commands>

  <section name="MIXER">
    <define name="ROLL_PART"  value="0.15"/>
    <define name="PITCH_PART" value="0.15"/>
    <define name="YAW_PART"   value="0.2"/>
  </section>

  <command_laws>
    <let var="roll"     value="ROLL_PART * @ROLL_DOT"/>
    <let var="pitch"    value="PITCH_PART * @PITCH_DOT"/>
    <let var="yaw"      value="YAW_PART * @YAW_DOT"/>
    <let var="throttle" value="@THROTTLE"/>
    <set servo="MOTOR_FRONT" value="$throttle + $pitch + $yaw"/>
    <set servo="MOTOR_BACK"  value="$throttle - $pitch + $yaw"/>
    <set servo="MOTOR_RIGHT" value="$throttle + $roll  - $yaw"/>
    <set servo="MOTOR_LEFT"  value="$throttle - $roll  - $yaw"/>
  </command_laws>


<control>
  <level name="rates">
    <loop name="roll_dot" type="P" pgain="100" measure="estimator_roll_dot" setpoint="setpoint_rolldot" output="command_roll_dot"/>
    <loop name="pitch_dot" type="PD" pgain="100" dgain="200" measure="estimator_pitch_dot" setpoint="setpoint_picthdot" output="command_pitch_dot"/>
  </level>

  <level name="attitudes">
    <loop name="roll" type="P" pgain="100" measure="estimator_roll" setpoint="setpoint_roll" output="setpoint_rolldot"/>
    <loop name="pitch" type="PD" pgain="100" dgain="200" measure="estimator_pitch" setpoint="setpoint_picth" output="setpoint_pitchdot"/>
  </level>



  <mode name="MANUAL">
    <input input="rc_values[COMMAND_THROTTLE]" output="control_commands[RADIO_THROTTLE]"/>
    <input input="rc_values[RADIO_ROLL]" output="control_setpoint_rolldot"/>
    <input input="rc_values[RADIO_PITCH]" output="control_setpoint_pitchdot"/>
    <input input="rc_values[RADIO_YAW]" output="control_setpoint_yawdot"/>
  </mode>

  <mode name="AUTO1">
    <input input="rc_values[COMMAND_THROTTLE]" output="control_commands[RADIO_THROTTLE]"/>
    <input input="rc_values[RADIO_ROLL]" output="control_setpoint_roll"/>
    <input input="rc_values[RADIO_PITCH]" output="control_setpoint_pitch"/>
    <input input="rc_values[RADIO_YAW]" output="control_setpoint_yawdot"/>
  </mode>

  <mode name="AUTO2">
    <input input="rc_values[COMMAND_THROTTLE]" output="control_commands[RADIO_THROTTLE]"/>
    <input input="rc_values[RADIO_ROLL]" output="control_setpoint_roll"/>
    <input input="rc_values[RADIO_PITCH]" output="control_setpoint_pitch"/>
    <input input="rc_values[RADIO_YAW]" output="control_setpoint_yawdot"/>
  </mode>

</control>


</airframe>