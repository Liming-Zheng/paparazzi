<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="QUAD COMPLETE EXT" version="2.0" release="BETA" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

	<fileheader>
		<author>Gervase Lovell-Prescod</author>
		<filecreationdate>2020-07-10</filecreationdate>
		<version>Version 1</version>
		<description>Simulation model of a tilting propeller tailsitter MAV using the Skywalker x5 foam airframe</description>
	</fileheader>
	
<!--**********************************************
	 			METRICS
	**********************************************	-->	
	
	<!--	
	<metrics>
		<wingarea unit="IN2"> 403 </wingarea>
	    <wingspan unit="IN"> 47.24 </wingspan>
	    <chord unit="IN"> 8.53 </chord>
	    <htailarea unit="FT2"> 0 </htailarea>
	    <htailarm unit="FT"> 0 </htailarm>
	    <vtailarea unit="FT2"> 0 </vtailarea>
	    <vtailarm unit="FT"> 0 </vtailarm>
	    <wing_incidence unit="DEG"> 90 </wing_incidence>
	    <location name="AERORP" unit="IN">
	      <x> 0 </x>
	      <y> 0 </y>
	      <z> 0 </z>
	    </location>
	    <location name="EYEPOINT" unite="IN">
	      <x> 0 </x>
	      <y> 0 </y>
	      <z> 0 </z>
	    </location>
	    <location name="VRP" unit="IN">
	      <x> 0 </x>
	      <y> 0 </y>
	      <z> 0 </z>
	    </location>
	</metrics>
	-->
	
	<metrics>
		<wingarea unit="IN2"> 115 </wingarea>
		<wingspan unit="IN"> 35.4 </wingspan>
		<chord unit="IN"> 7.09 </chord>
		<htailarea unit="FT2"> 0 </htailarea>
		<htailarm unit="FT"> 0 </htailarm>
		<vtailarea unit="FT2"> 0 </vtailarea>
		<vtailarm unit="FT"> 0 </vtailarm>
		<wing_incidence unit="DEG"> 90 </wing_incidence>
		<location name="AERORP" unit="IN">
			<x> 0 </x>
			<y> 0 </y>
			<z> 0 </z>
		</location>
		<location name="EYEPOINT" unit="IN">
			<x> 0 </x>
			<y> 0 </y>
			<z> 0 </z>
		</location>
		<location name="VRP" unit="IN">
			<x> 0 </x>
			<y> 0 </y>
			<z> 0 </z>
		</location>
	</metrics>

<!--**********************************************
	 			MASS BALANCE
	**********************************************	-->
	
	<mass_balance>
	<!--
		<ixx unit="SLUG*FT2"> 0.0056452996 </ixx>
		<iyy unit="SLUG*FT2"> 0.02407556 </iyy>
		<izz unit="SLUG*FT2"> 0.0029480072 </izz> -->
		<ixx unit="SLUG*FT2"> 0.0488062 </ixx>
		<iyy unit="SLUG*FT2"> 0.0362506 </iyy>
		<izz unit="SLUG*FT2"> 0.0129264 </izz> 
<!--  These are cyclone values	   
		<ixx unit="SLUG*FT2"> 0.0132 </ixx>
		<iyy unit="SLUG*FT2"> 0.00250 </iyy>
		<izz unit="SLUG*FT2"> 0.0150 </izz>-->
		<ixy unit="SLUG*FT2"> 0. </ixy>
		<ixz unit="SLUG*FT2"> 0. </ixz>
		<iyz unit="SLUG*FT2"> 0. </iyz>
		<emptywt unit="LBS"> 2.8 </emptywt>
		<location name="CG" unit="M">
			<x> 0 </x>
			<y> 0 </y>
			<z> 0 </z>
		</location>
	</mass_balance>
	
	
<!--**********************************************
	 			GROUND CONTACTS
	**********************************************
	The locations in this section are given in the
	structural coordinate system					-->
	<ground_reactions>
		
	    <contact type="STRUCTURE" name="CONTACT_FRONT">
	      <location unit="M">
	        <x> -0.15 </x>
	        <y> 0 </y>
	        <z>-0.1 </z>
	      </location>
	      <static_friction>  0.8 </static_friction>
	      <dynamic_friction> 0.5 </dynamic_friction>
	      <spring_coeff unit="N/M"> 500 </spring_coeff>
	      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
	      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
	      <max_steer unit="DEG"> 0.0 </max_steer>
	      <brake_group> NONE </brake_group>
	      <retractable>0</retractable>
	    </contact>
		
		
	    <contact type="STRUCTURE" name="CONTACT_BACK">
	      <location unit="M">
	        <x> 0.15</x>
	        <y> 0   </y>
	        <z>-0.1 </z>
	      </location>
	      <static_friction>  0.8 </static_friction>
	      <dynamic_friction> 0.5 </dynamic_friction>
	      <spring_coeff unit="N/M"> 500 </spring_coeff>
	      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
	      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
	      <max_steer unit="DEG"> 0.0 </max_steer>
	      <brake_group> NONE </brake_group>
	      <retractable>0</retractable>
	    </contact>
		
		
	    <contact type="STRUCTURE" name="CONTACT_RIGHT">
	      <location unit="M">
	        <x> 0.0  </x>
	        <y> 0.15</y>
	        <z>-0.1 </z>
	      </location>
	      <static_friction>  0.8 </static_friction>
	      <dynamic_friction> 0.5 </dynamic_friction>
	      <spring_coeff unit="N/M"> 500 </spring_coeff>
	      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
	      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
	      <max_steer unit="DEG"> 0.0 </max_steer>
	      <brake_group> NONE </brake_group>
	      <retractable>0</retractable>
	    </contact>
	
		<contact type="STRUCTURE" name="CONTACT_LEFT">
	      <location unit="M">
	        <x> 0.0  </x>
	        <y>-0.15</y>
	        <z>-0.1 </z>
	      </location>
	      <static_friction>  0.8 </static_friction>
	      <dynamic_friction> 0.5 </dynamic_friction>
	      <spring_coeff unit="N/M"> 500 </spring_coeff>
	      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
	      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
	      <max_steer unit="DEG"> 0.0 </max_steer>
	      <brake_group> NONE </brake_group>
	      <retractable>0</retractable>
	    </contact>
	</ground_reactions>

<!--**********************************************
	 			FLIGHT CONTROLS
	**********************************************	-->		

	<flight_control name="actuator_dynamics">
		<channel name="filtering">
		<!-- First order filter represents actuator dynamics -->
			<lag_filter name="tilt_left_lag">
				<input> fcs/tilt_left </input>
				<c1> 65 </c1> <!-- 54 from cyclone file -->
				<!--  <delay type="time"> 0.015 </delay> -->
				<output> fcs/tilt_left_lag</output>
			</lag_filter>
			<lag_filter name="tilt_right_lag">
				<input> fcs/tilt_right </input>
				<c1> 65 </c1>
				<!--  <delay type="time"> 0.015 </delay> -->
				<output> fcs/tilt_right_lag </output>
			</lag_filter>
			<lag_filter name="mot_right_lag">
				<input> fcs/mot_right </input>
				<c1> 31.7 </c1> <!-- 31.7 from cyclone file -->
				<output> fcs/mot_right_lag </output>
			</lag_filter>
			<lag_filter name="mot_left_lag">
				<input> fcs/mot_left </input>
				<c1> 31.7 </c1>
				<output> fcs/mot_left_lag </output>
			</lag_filter>
		</channel>
	</flight_control>
<!--	<flight_control name="actuator_dynamics">
		<channel name="filtering">
			<second_order_filter name="tilt_left_lag">
				<input> fcs/tilt_left </input>
				<c1> 0 </c1>
				<c2> 0 </c2>
				<c3> 6400 </c3>
				<c4> 1 </c4>
				<c5> 128 </c5>
				<c6> 6400 </c6>				-->
				<!--  <delay type="time"> 0.014 </delay> -->
<!--				<output> fcs/tilt_left_lag</output>
			</second_order_filter>
			<second_order_filter name="tilt_right_lag">
				<input> fcs/tilt_right </input>
				<c1> 0 </c1>
				<c2> 0 </c2>
				<c3> 6400 </c3>
				<c4> 1 </c4>
				<c5> 128 </c5>
				<c6> 6400 </c6>				-->
				<!--  <delay type="time"> 0.014 </delay> -->
<!--				<output> fcs/tilt_right_lag </output>
			</second_order_filter>
			<lag_filter name="mot_right_lag">
				<input> fcs/mot_right </input>
				<c1> 18 </c1>
				<output> fcs/mot_right_lag </output>
			</lag_filter>
			<lag_filter name="mot_left_lag">
				<input> fcs/mot_left </input>
				<c1> 18 </c1>
				<output> fcs/mot_left_lag </output>
			</lag_filter>
		</channel>
	</flight_control> -->
	
<!--**********************************************
	 			EXTERNAL REACTIONS
	**********************************************	-->	
	<!-- Same order as in the above section -->
	<external_reactions>
		<property> fcs/tilt_left </property>
		<property> fcs/tilt_left_lag </property>
		<property> fcs/tilt_right </property>
		<property> fcs/tilt_right_lag </property>
		<property> fcs/mot_right </property>
		<property> fcs/mot_right_lag </property>
		<property> fcs/mot_left </property>
		<property> fcs/mot_left_lag </property>
	
		

		
		<!-- Lift motors: force couples motors -->
		
		<!--________________LEFT MOTOR________________-->
		<force name="mot_left_1" frame="BODY" unit="LBS">
			<function>
				<product>
					<product>
						<value> 0.224809 </value> <!-- N to LBS -->
						<!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
						<sum>
							<product>
								<value> 4.8786 </value> <!-- K1 -->
								<property> fcs/mot_left_lag </property>
								<property> fcs/mot_left_lag </property>
							</product>
							<product>
								<value> 3.5412 </value> <!-- K2 -->
								<property> fcs/mot_left_lag </property>
							</product>
							<value> 0.1175 </value> <!-- K3 -->
						</sum>
						<!-- __________________________________________________________  -->
					</product>
					<sin>
						<product>
							<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
							<property> fcs/tilt_left_lag </property>
						</product>
					</sin>
				</product>
			</function>
			<location unit="IN">
				<x> 0 </x>
				<y> -12 </y>
				<z> 6 </z>
			</location>
			<direction>
				<x> -1 </x>
				<y> 0 </y>
				<z> 0 </z>
			</direction>
		</force>
		
		<force name="mot_left_2" frame="BODY" unit="LBS">
			<function>
				<product>
					<product>
						<value> 0.224809 </value> <!-- N to LBS -->
						<!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
						<sum>
							<product>
								<value> 4.8786 </value> <!-- K1 -->
								<property> fcs/mot_left_lag </property>
								<property> fcs/mot_left_lag </property>
							</product>
							<product>
								<value> 3.5412 </value> <!-- K2 -->
								<property> fcs/mot_left_lag </property>
							</product>
							<value> 0.1175 </value> <!-- K3 -->
						</sum>
						<!-- __________________________________________________________  -->
					</product>
					<cos>
						<product>
							<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
							<property> fcs/tilt_left_lag </property>
						</product>
					</cos>
				</product>
			</function>
			<location unit="IN">
				<x> 0 </x>
				<y> -12 </y>
				<z> 6 </z>
			</location>
			<direction>
				<x> 0 </x>
				<y> 0 </y>
				<z> -1 </z>
			</direction>
		</force>
		
		<!--________________RIGHT MOTOR________________-->
		<force name="mot_right_1" frame="BODY" unit="LBS">
			<function>
				<product>
					<product>
						<value> 0.224809 </value> <!-- N to LBS -->
						<!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
						<sum>
							<product>
								<value> 4.8786 </value> <!-- K1 -->
								<property> fcs/mot_right_lag </property>
								<property> fcs/mot_right_lag </property>
							</product>
							<product>
								<value> 3.5412 </value> <!-- K2 -->
								<property> fcs/mot_right_lag </property>
							</product>
							<value> 0.1175 </value> <!-- K3 -->
						</sum>
						<!-- __________________________________________________________  -->
					</product>
					<sin>
						<product>
							<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
							<property> fcs/tilt_right_lag </property>
						</product>
					</sin>
				</product>
			</function>
			<location unit="IN">
				<x> 0 </x>
				<y> 12 </y>
				<z> 6 </z>
			</location>
			<direction>
				<x> -1 </x>
				<y> 0 </y>
				<z> 0 </z>
			</direction>
		</force>
		
		<force name="mot_right_2" frame="BODY" unit="LBS">
			<function>
				<product>
					<product>
						<value> 0.224809 </value> <!-- N to LBS -->
						<!-- Thrust Curve y = K1 x^2 + K2 x + K3 (x on range [0, 1]) [N] -->
						<sum>
							<product>
								<value> 4.8786 </value> <!-- K1 -->
								<property> fcs/mot_right_lag </property>
								<property> fcs/mot_right_lag </property>
							</product>
							<product>
								<value> 3.5412 </value> <!-- K2 -->
								<property> fcs/mot_right_lag </property>
							</product>
							<value> 0.1175 </value> <!-- K3 -->
						</sum>
						<!-- __________________________________________________________  -->
					</product>
					<cos>
						<product>
							<value> 0.9599 </value> <!-- [rad] gradient correspond to max angle based on max PWM in airframe file -->
							<property> fcs/tilt_right_lag </property>
						</product>
					</cos>
				</product>
			</function>
			<location unit="IN">
				<x> 0 </x>
				<y> 12 </y>
				<z> 6 </z>
			</location>
			<direction>
				<x> 0 </x>
				<y> 0 </y>
				<z> -1 </z>
			</direction>
		</force>
		
		
	</external_reactions>
	
	<!-- The below "<propulsion/> was commented out by me -->
	<!--    <propulsion/> -->
	
	<flight_control name="FGFCS"/>

	<aerodynamics file="Systems/aerodynamics_tiltprop_tailsitter.xml"/>
	
	
</fdm_config>


